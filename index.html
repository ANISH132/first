<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Will you be my Valentine</title>
<style>
  :root{
    --bg1: #ffedf0;
    --bg2: #ffe0e6;
    --accent: #ff6b81;
    --accent-dark: #c94b63;
    --shadow: 0 12px 40px rgba(201,72,93,0.14);
    --radius: 18px;
  }

  /* Romantic animated background */
  html,body{height:100%;margin:0;font-family:"Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;}
  body{
    background: radial-gradient(1200px 600px at 10% 20%, rgba(255,182,193,0.12), transparent 10%),
                radial-gradient(1000px 500px at 90% 80%, rgba(255,192,203,0.10), transparent 12%),
                linear-gradient(135deg, #fff0f2 0%, #ffeef0 40%, #fff6f8 100%);
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#3b0b0f;
  }

  /* subtle slow-moving overlay to add life */
  .bg-animate {
    position:fixed;inset:0;z-index:0;pointer-events:none;
    background: linear-gradient(120deg, rgba(255,105,135,0.02), rgba(255,200,220,0.02));
    animation: bgShift 18s linear infinite;
    mix-blend-mode: screen;
  }
  @keyframes bgShift{
    0%{transform:translateY(0) rotate(0deg)}
    50%{transform:translateY(-6%) rotate(2deg)}
    100%{transform:translateY(0) rotate(0deg)}
  }

  /* Main card */
  .card{
    width:min(920px,94vw);
    background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.86));
    border-radius: var(--radius);
    padding:36px;
    box-shadow: var(--shadow);
    position:relative;
    overflow:visible;
    text-align:center;
    z-index:30;
  }
  h1{margin:0 0 8px 0;font-size:36px;color:#6b0f1a;}
  p.lead{margin:0 0 22px 0;color:#7a2a36;font-size:18px;}
  .btn-row{display:flex;gap:18px;justify-content:center;margin-top:12px;}
  .btn{padding:14px 28px;border-radius:12px;border:0;cursor:pointer;font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,0.08);transition:transform .14s ease, box-shadow .14s ease;font-size:18px;}
  .btn:active{transform:translateY(2px)}
  .btn-yes{background: linear-gradient(90deg,#ff9aa2,#ff6b81);color:white;}
  .btn-no{background: linear-gradient(90deg,#fff1f3,#ffdbe0);color:var(--accent-dark);border:1px solid rgba(201,72,93,0.08);}

  /* small floating hearts (side columns) */
  .hearts-left, .hearts-right{
    position:fixed;top:0;bottom:0;width:120px;pointer-events:none;
    display:flex;flex-direction:column;align-items:center;justify-content:flex-end;z-index:20;
  }
  .hearts-left{left:8px;}
  .hearts-right{right:8px;}
  .heart{position:relative;transform:rotate(-45deg) scale(0.9);opacity:0.95;margin-bottom:12px;animation: floatUp linear infinite;}
  .heart svg{display:block;transform:rotate(45deg);}

  @keyframes floatUp{
    0%{transform: translateY(0) rotate(-45deg) scale(0.8); opacity:0;}
    10%{opacity:1}
    100%{transform: translateY(-120vh) rotate(-45deg) scale(1.05); opacity:0;}
  }

  /* Heart bubble layer (large translucent heart "bubbles") */
  .bubble-layer{
    position:fixed;inset:0;pointer-events:none;z-index:10;overflow:hidden;
  }
  .heart-bubble{
    position:absolute;
    width:80px;height:80px;
    opacity:0.18;
    transform-origin:center;
    will-change: transform, opacity, top, left;
    animation: bubbleRise linear infinite;
    filter: blur(0.6px) saturate(120%);
  }
  .heart-bubble svg{width:100%;height:100%;display:block;fill:currentColor;}
  @keyframes bubbleRise{
    0%{ transform: translateY(0) scale(0.8); opacity:0; }
    10%{ opacity:0.7; }
    60%{ opacity:0.35; }
    100%{ transform: translateY(-130vh) scale(1.2); opacity:0; }
  }

  /* Modal & typewriter */
  .modal-backdrop{
    position:fixed;inset:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;
    z-index:40;backdrop-filter: blur(4px);
  }
  .modal{
    background:linear-gradient(180deg,#fff,rgba(255,255,255,0.98));
    padding:22px;border-radius:14px;box-shadow:0 12px 40px rgba(0,0,0,0.18);width:min(520px,92vw);
    text-align:center;
  }
  .modal h3{margin:0 0 8px 0;color:#6b0f1a;}
  .modal p{margin:0 0 16px 0;color:#7a2a36;}
  .typewriter { font-size:18px; color:#6b0f1a; white-space:pre-wrap; text-align:center; line-height:1.4; min-height:48px; }

  /* Celebration photo frame */
  .celebrate{position:fixed;inset:0;z-index:50;display:flex;align-items:center;justify-content:center;pointer-events:none;}
  .photo-frame{margin-top:18px;border-radius:14px;overflow:hidden;border:6px solid rgba(255,255,255,0.6);width:min(640px,92vw);box-shadow:0 18px 50px rgba(107,15,26,0.18);background:#fff;}
  .photo-frame img{width:100%;height:auto;display:block;}

  @media (max-width:520px){
    h1{font-size:26px}
    .btn{font-size:16px;padding:12px 18px}
  }
</style>
</head>
<body>

<div class="bg-animate" aria-hidden="true"></div>

<!-- Heart bubble layer (behind card but above background) -->
<div class="bubble-layer" id="bubbleLayer" aria-hidden="true"></div>

<!-- Floating hearts containers (small hearts on sides) -->
<div class="hearts-left" aria-hidden="true"></div>
<div class="hearts-right" aria-hidden="true"></div>

<!-- Main card -->
<div class="card" id="mainCard" role="main" aria-labelledby="title">
  <h1 id="title">Will you be my Valentine</h1>
  <p class="lead">I made this just for you â€” choose your answer and see what happens.</p>

  <div class="btn-row" role="group" aria-label="Answer choices">
    <button class="btn btn-yes" id="yesBtn" aria-label="Yes">Yes</button>
    <button class="btn btn-no" id="noBtn" aria-label="No">No</button>
  </div>
</div>

<div id="modalRoot" aria-live="polite"></div>
<div id="celebrateRoot" aria-live="polite"></div>

<script>
/* injectedImage placeholder (replaced by app.py) */
const injectedImage = "{{IMAGE_DATA}}";
let uploadedDataUrl = injectedImage || null;

/* Small floating hearts (side columns) */
function spawnSideHearts(container, count=12){
  const colors = ['#ff6b81','#ff9aa2','#ffb7c5','#ffd1dc','#ff8fa3'];
  for(let i=0;i<count;i++){
    const h = document.createElement('div');
    h.className = 'heart';
    const size = 14 + Math.round(Math.random()*28);
    h.style.width = size + 'px';
    h.style.height = size + 'px';
    h.style.marginBottom = (6 + Math.random()*22) + 'px';
    h.style.animationDuration = (7 + Math.random()*10) + 's';
    h.style.animationDelay = (Math.random()*6) + 's';
    const color = colors[Math.floor(Math.random()*colors.length)];
    h.innerHTML = '<svg viewBox="0 0 32 29" width="'+size+'" height="'+size+'" aria-hidden="true"><path fill="'+color+'" d="M23.6 0c-2.9 0-5.4 1.7-6.6 4.1C15.8 1.7 13.3 0 10.4 0 4.7 0 0 4.7 0 10.4c0 6.6 7.2 11.9 18.1 18.2L16 29l2.1-.4C24.8 22.3 32 17 32 10.4 32 4.7 27.3 0 21.6 0z"/></svg>';
    container.appendChild(h);
    setTimeout(()=>{ try{ container.removeChild(h);}catch(e){} }, 30000);
  }
}

/* Heart bubble generator (floating translucent heart "bubbles") */
function spawnHeartBubbles(layer, count=10){
  const colors = ['rgba(255,105,135,0.18)','rgba(255,182,193,0.18)','rgba(255,192,203,0.18)','rgba(255,150,170,0.18)'];
  for(let i=0;i<count;i++){
    const b = document.createElement('div');
    b.className = 'heart-bubble';
    const size = 40 + Math.round(Math.random()*120);
    b.style.width = size + 'px';
    b.style.height = size + 'px';
    b.style.left = Math.random()*100 + '%';
    b.style.bottom = (-20 - Math.random()*40) + 'px';
    b.style.color = colors[Math.floor(Math.random()*colors.length)];
    b.style.opacity = (0.08 + Math.random()*0.22).toString();
    const dur = 10 + Math.random()*18;
    b.style.animationDuration = dur + 's';
    b.style.animationDelay = (Math.random()*6) + 's';
    b.style.transform = 'translateY(0) rotate(' + (Math.random()*40 - 20) + 'deg) scale(' + (0.8 + Math.random()*0.6) + ')';
    // heart SVG (uses currentColor)
    b.innerHTML = '<svg viewBox="0 0 32 29" aria-hidden="true"><path d="M23.6 0c-2.9 0-5.4 1.7-6.6 4.1C15.8 1.7 13.3 0 10.4 0 4.7 0 0 4.7 0 10.4c0 6.6 7.2 11.9 18.1 18.2L16 29l2.1-.4C24.8 22.3 32 17 32 10.4 32 4.7 27.3 0 21.6 0z"/></svg>';
    layer.appendChild(b);
    // remove after animation completes to keep DOM light
    setTimeout(()=>{ try{ layer.removeChild(b);}catch(e){} }, (dur + 2) * 1000);
  }
}

/* initialize decorative elements */
const left = document.querySelector('.hearts-left');
const right = document.querySelector('.hearts-right');
spawnSideHearts(left, 12);
spawnSideHearts(right, 12);
setInterval(()=>spawnSideHearts(left, 5), 6000);
setInterval(()=>spawnSideHearts(right, 5), 7000);

const bubbleLayer = document.getElementById('bubbleLayer');
spawnHeartBubbles(bubbleLayer, 12);
setInterval(()=>spawnHeartBubbles(bubbleLayer, 6), 4200);

/* toast */
function showToast(msg){
  const t = document.createElement('div'); t.textContent = msg;
  Object.assign(t.style,{position:'fixed',bottom:'28px',left:'50%',transform:'translateX(-50%)',background:'rgba(255,255,255,0.95)',padding:'10px 16px',borderRadius:'12px',boxShadow:'0 8px 20px rgba(0,0,0,0.12)',zIndex:60});
  document.body.appendChild(t); setTimeout(()=>t.style.opacity='0',2000); setTimeout(()=>t.remove(),2600);
}

/* confetti */
function launchConfetti(){
  const root = document.getElementById('celebrateRoot');
  const wrap = document.createElement('div'); wrap.className='celebrate'; wrap.style.pointerEvents='none';
  const canvas = document.createElement('canvas'); canvas.width = innerWidth; canvas.height = innerHeight;
  wrap.appendChild(canvas); document.body.appendChild(wrap);
  const ctx = canvas.getContext('2d');
  const colors = ['#ff6b81','#ffd1dc','#ff9aa2','#ffb7c5','#fff176','#ff8fa3'];
  const pieces = [];
  for(let i=0;i<160;i++){
    pieces.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height*0.6,vx:(Math.random()-0.5)*6,vy:-(2+Math.random()*6),size:6+Math.random()*10,color:colors[Math.floor(Math.random()*colors.length)],rot:Math.random()*360,vr:(Math.random()-0.5)*8});
  }
  let t0=null;
  function frame(ts){
    if(!t0) t0=ts; const dt=(ts-t0)/1000; t0=ts;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let p of pieces){ p.x+=p.vx; p.y+=p.vy; p.vy+=0.12; p.rot+=p.vr; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180); ctx.fillStyle=p.color; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6); ctx.restore(); }
    if(pieces.length && pieces[0].y > canvas.height + 200){ try{ canvas.remove(); wrap.remove(); }catch(e){} return; }
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
}

/* hide the question card */
function hideQuestions(){
  const card = document.getElementById('mainCard');
  if(card) card.style.display = 'none';
}

/* show celebration only */
function showCelebration(){
  hideQuestions();
  launchConfetti();
  const root = document.getElementById('celebrateRoot');
  if(uploadedDataUrl){
    const frame = document.createElement('div'); frame.className='photo-frame'; frame.style.zIndex=55;
    frame.innerHTML = '<img src="'+uploadedDataUrl+'" alt="Us">';
    root.appendChild(frame);
    setTimeout(()=>{ try{ root.removeChild(frame);}catch(e){} }, 12000);
  } else {
    const frame = document.createElement('div'); frame.className='photo-frame'; frame.style.zIndex=55;
    frame.innerHTML = '<div style="padding:28px;font-size:20px;color:#6b0f1a">Celebration time!</div>';
    root.appendChild(frame);
    setTimeout(()=>{ try{ root.removeChild(frame);}catch(e){} }, 8000);
  }
}

/* modal system */
const modalRoot = document.getElementById('modalRoot'); let currentModal = null;
function showModal(title, message, buttons = []){
  closeModal();
  const backdrop = document.createElement('div'); backdrop.className='modal-backdrop'; backdrop.tabIndex=-1;
  const modal = document.createElement('div'); modal.className='modal';
  modal.innerHTML = '<h3>'+title+'</h3><p>'+message+'</p>';
  const btnRow = document.createElement('div'); btnRow.style.display='flex'; btnRow.style.justifyContent='center'; btnRow.style.gap='12px';
  buttons.forEach(b=>{
    const btn = document.createElement('button'); btn.textContent = b.label; btn.style.padding='10px 14px'; btn.style.borderRadius='10px'; btn.style.cursor='pointer';
    if(b.style==='primary'){ btn.style.background='linear-gradient(90deg,#ff9aa2,#ff6b81)'; btn.style.color='white'; btn.style.border='none'; }
    else { btn.style.background='transparent'; btn.style.border='1px solid rgba(107,15,26,0.08)'; btn.style.color='#6b0f1a'; }
    btn.addEventListener('click', ()=> b.action && b.action());
    btnRow.appendChild(btn);
  });
  modal.appendChild(btnRow); backdrop.appendChild(modal); modalRoot.appendChild(backdrop); currentModal = backdrop;
  return backdrop;
}
function closeModal(){ if(currentModal){ try{ modalRoot.removeChild(currentModal);}catch(e){} currentModal = null; } }

/* Typewriter popup: types in 2 seconds, visible for 9 seconds, includes romantic emojis */
function showTypewriterThenCelebrate(customText){
  closeModal();
  const text = customText || "I love you soooo muchhhh, my Royal Bholi!!! â¤ï¸ðŸ˜ðŸ’–ðŸ’˜";
  const backdrop = document.createElement('div'); backdrop.className='modal-backdrop';
  const modal = document.createElement('div'); modal.className='modal';
  const container = document.createElement('div'); container.className = 'typewriter';
  modal.appendChild(container);
  backdrop.appendChild(modal);
  modalRoot.appendChild(backdrop);
  currentModal = backdrop;

  // Typewriter: reveal characters over 2 seconds
  const totalTypeDuration = 2000; // ms to type
  const totalVisible = 3000; // ms total popup visible
  const chars = Array.from(text);
  const interval = Math.max(4, Math.floor(totalTypeDuration / chars.length));
  let i = 0;
  container.textContent = '';
  const typer = setInterval(()=>{
    container.textContent += chars[i] || '';
    i++;
    if(i >= chars.length){
      clearInterval(typer);
    }
  }, interval);

  // After totalVisible ms, close and jump to celebration
  setTimeout(()=>{
    try{ modalRoot.removeChild(backdrop); }catch(e){}
    currentModal = null;
    showCelebration();
  }, totalVisible);
}

/* Sequential pop-up flow (exact wording requested)
   - Sequence of four questions (exact titles).
   - Clicking Yes advances to next question immediately.
   - Clicking No triggers the typewriter popup (2s typing, visible 9s) and then jumps directly to celebration.
   - After the final question, any response goes to celebration.
*/
const sequence = [
  { title: "Are you sure with 'No'?", message: "" },
  { title: "Really Bhujjiii, Are you sure with 'No'? , i want to be your valentine", message: "" },
  { title: "Damn Bitch!,Are you sure with 'No'? be my Valentine pleaseeeeee!", message: "" },
  { title: "In THAT case 'No' means 'Yes' babyyyyyy!!!!!!", message: "" }
];

let seqIndex = 0;
function openNextInSequence(){
  if(seqIndex >= sequence.length){
    showCelebration();
    seqIndex = 0;
    return;
  }
  const item = sequence[seqIndex];
  const isLast = (seqIndex === sequence.length - 1);

  showModal(item.title, item.message || "Don't say Yes!!!", [
    { label: 'Yes', style: 'primary', action: ()=>{ 
        closeModal();
        seqIndex++;
        if(isLast) showCelebration(); else openNextInSequence();
      } 
    },
    { label: 'No', style: 'ghost', action: ()=>{ 
        closeModal();
        // On any No, show typewriter popup (2s typing) then jump directly to celebration
        showTypewriterThenCelebrate("I love you soooo muchhhh, my Royal Bholi!!! â¤ï¸ðŸ˜ðŸ’–ðŸ’˜");
      } 
    }
  ]);
}

/* Attach No button to start the sequence */
const noBtn = document.getElementById('noBtn');
noBtn.addEventListener('click', ()=>{
  seqIndex = 0;
  openNextInSequence();
});

/* Yes button: show typewriter then celebration as requested */
const yesBtn = document.getElementById('yesBtn');
yesBtn.addEventListener('click', ()=>{
  showTypewriterThenCelebrate("I love you soooo muchhhh, my Royal Bholi!!! â¤ï¸ðŸ˜ðŸ’–ðŸ’˜");
});

/* keyboard */
document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

</script>
</body>
</html>
